<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>File Upload Test</title>
    <style>
        #dropbox {
            width: 300px;
            height: 200px;
            border: 2px dashed #ccc;
            text-align: center;
            padding: 10px;
            margin: 20px auto;
        }

        #dropbox.highlight {
            background-color: #e8f9ff;
        }

        progress.success::-webkit-progress-bar {
            background-color: green;
        }
    </style>
    <script>
        var dropbox;

        function handleFileUpload(file) {
            // create an element in the dropbox for the file with a pie chart progress bar at 0% and a shortened file name below it put an id on the progress bar so we can update it later
            var progressBar = document.createElement("progress");
            progressBar.id = file.name + "-progress";
            progressBar.value = 0;
            progressBar.max = 100;
            dropbox.appendChild(progressBar);
            var fileName = document.createElement("p");
            fileName.innerHTML = shortenFileName(file.name);
            dropbox.appendChild(fileName);

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/new-idea/upload/" + file.name, true);

            xhr.upload.onprogress = function (e) {
                var percentCompleted = Math.round((e.loaded / e.total) * 100);
                progressBar.value = percentCompleted;
            };

            xhr.onload = function () {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.message === "success") {
                        progressBar.classList.add("success");
                        // update the progress bar to 100%
                        progressBar.value = 100;

                        var thumbnailURL = response.thumbnailURL;
                        // Display the thumbnailURL in the UI
                    } else {
                        var errorMessage = response.message;
                        // Display the error message in the UI
                    }
                }
            };

            xhr.onerror = function () {
                // Handle any errors that occur during the upload
            };

            xhr.send(file);
        }

        // function to rewrite long file names as max 8+extension
        function shortenFileName(fileName) {
            var extension = fileName.split('.').pop();
            var fileName = fileName.split('.').slice(0, -1).join('.');
            if (fileName.length > 8) {
                fileName = fileName.substring(0, 8) + '...';
            }
            return fileName + '.' + extension;
        }

        function handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            var files = event.dataTransfer.files;
            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                handleFileUpload(file);
            }
            dropbox.classList.remove("highlight");
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            dropbox.classList.add("highlight");
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            dropbox.classList.remove("highlight");
        }

        document.addEventListener("DOMContentLoaded", function () {
            dropbox = document.getElementById("dropbox");
            dropbox.addEventListener("dragover", handleDragOver);
            dropbox.addEventListener("dragleave", handleDragLeave);
            dropbox.addEventListener("drop", handleDrop);
        });
    </script>
</head>

<body>
    <h1>File Upload Test</h1>

    <div id="dropbox">
        <p>Drag and drop files here</p>
    </div>

</body>

</html>